{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "zizmor configuration",
  "description": "Configuration file for zizmor, a static analysis tool for GitHub Actions\nhttps://docs.zizmor.sh/configuration/",
  "type": "object",
  "properties": {
    "rules": {
      "anyOf": [
        {
          "$ref": "#/definitions/RulesConfig"
        },
        {
          "type": "null"
        }
      ]
    }
  },
  "additionalProperties": false,
  "definitions": {
    "BaseRuleConfig": {
      "type": "object",
      "properties": {
        "disable": {
          "default": false,
          "type": "boolean"
        },
        "ignore": {
          "default": [],
          "type": "array",
          "items": {
            "$ref": "#/definitions/WorkflowRule"
          }
        }
      },
      "additionalProperties": false
    },
    "DependabotCooldownConfig": {
      "type": "object",
      "properties": {
        "days": {
          "default": 0,
          "type": "integer",
          "format": "uint64",
          "minimum": 0.0
        }
      },
      "additionalProperties": false
    },
    "DependabotCooldownRuleConfig": {
      "type": "object",
      "properties": {
        "config": {
          "anyOf": [
            {
              "$ref": "#/definitions/DependabotCooldownConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "disable": {
          "default": false,
          "type": "boolean"
        },
        "ignore": {
          "default": [],
          "type": "array",
          "items": {
            "$ref": "#/definitions/WorkflowRule"
          }
        }
      },
      "additionalProperties": false
    },
    "ForbiddenUsesAllowConfig": {
      "type": "object",
      "required": [
        "allow"
      ],
      "properties": {
        "allow": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/RepositoryUsesPattern"
          }
        }
      },
      "additionalProperties": false
    },
    "ForbiddenUsesConfig": {
      "anyOf": [
        {
          "$ref": "#/definitions/ForbiddenUsesAllowConfig"
        },
        {
          "$ref": "#/definitions/ForbiddenUsesDenyConfig"
        }
      ]
    },
    "ForbiddenUsesDenyConfig": {
      "type": "object",
      "required": [
        "deny"
      ],
      "properties": {
        "deny": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/RepositoryUsesPattern"
          }
        }
      },
      "additionalProperties": false
    },
    "ForbiddenUsesRuleConfig": {
      "type": "object",
      "properties": {
        "config": {
          "anyOf": [
            {
              "$ref": "#/definitions/ForbiddenUsesConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "disable": {
          "default": false,
          "type": "boolean"
        },
        "ignore": {
          "default": [],
          "type": "array",
          "items": {
            "$ref": "#/definitions/WorkflowRule"
          }
        }
      },
      "additionalProperties": false
    },
    "RepositoryUsesPattern": {
      "description": "A pattern for matching GitHub Actions repository uses. Patterns can be: '*' (any), 'owner/*' (any repo under owner), 'owner/repo' (exact repo), 'owner/repo/*' (any path in repo), 'owner/repo/path' (exact path), or 'owner/repo@ref' (exact ref)",
      "type": "string"
    },
    "RulesConfig": {
      "type": "object",
      "properties": {
        "anonymous-definition": {
          "description": "workflow or action definition without a name",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "archived-uses": {
          "description": "action or reusable workflow from archived repository",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "artipacked": {
          "description": "credential persistence through GitHub Actions artifacts",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "bot-conditions": {
          "description": "spoofable bot actor check",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "cache-poisoning": {
          "description": "runtime artifacts potentially vulnerable to a cache poisoning attack",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "concurrency-limits": {
          "description": "insufficient job-level concurrency limits",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "dangerous-triggers": {
          "description": "use of fundamentally insecure workflow trigger",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "dependabot-cooldown": {
          "description": "insufficient cooldown in Dependabot updates",
          "anyOf": [
            {
              "$ref": "#/definitions/DependabotCooldownRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "dependabot-execution": {
          "description": "external code execution in Dependabot updates",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "excessive-permissions": {
          "description": "overly broad permissions",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "forbidden-uses": {
          "description": "forbidden action used",
          "anyOf": [
            {
              "$ref": "#/definitions/ForbiddenUsesRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "github-env": {
          "description": "dangerous use of environment file",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "hardcoded-container-credentials": {
          "description": "hardcoded credential in GitHub Actions container configurations",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "impostor-commit": {
          "description": "commit with no history in referenced repository",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "insecure-commands": {
          "description": "execution of insecure workflow commands is enabled",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "known-vulnerable-actions": {
          "description": "action has a known vulnerability",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "obfuscation": {
          "description": "obfuscated usage of GitHub Actions features",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "overprovisioned-secrets": {
          "description": "excessively provisioned secrets",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "ref-confusion": {
          "description": "git ref for action with ambiguous ref type",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "ref-version-mismatch": {
          "description": "detects commit SHAs that don't match their version comment tags",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "secrets-inherit": {
          "description": "secrets unconditionally inherited by called workflow",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "self-hosted-runner": {
          "description": "runs on a self-hosted runner",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "stale-action-refs": {
          "description": "commit hash does not point to a Git tag",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "template-injection": {
          "description": "code injection via template expansion",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "undocumented-permissions": {
          "description": "permissions without explanatory comments",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "unpinned-images": {
          "description": "unpinned image references",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "unpinned-uses": {
          "description": "unpinned action reference",
          "anyOf": [
            {
              "$ref": "#/definitions/UnpinnedUsesRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "unredacted-secrets": {
          "description": "leaked secret values",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "unsound-condition": {
          "description": "unsound conditional expression",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "unsound-contains": {
          "description": "unsound contains condition",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "use-trusted-publishing": {
          "description": "prefer trusted publishing for authentication",
          "anyOf": [
            {
              "$ref": "#/definitions/BaseRuleConfig"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "UnpinnedUsesConfig": {
      "type": "object",
      "properties": {
        "policies": {
          "description": "A mapping of action patterns to pinning policies. Keys are patterns like '*', 'owner/*', 'owner/repo', etc.",
          "default": {},
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/UsesPolicy"
          }
        }
      },
      "additionalProperties": false
    },
    "UnpinnedUsesRuleConfig": {
      "type": "object",
      "properties": {
        "config": {
          "anyOf": [
            {
              "$ref": "#/definitions/UnpinnedUsesConfig"
            },
            {
              "type": "null"
            }
          ]
        },
        "disable": {
          "default": false,
          "type": "boolean"
        },
        "ignore": {
          "default": [],
          "type": "array",
          "items": {
            "$ref": "#/definitions/WorkflowRule"
          }
        }
      },
      "additionalProperties": false
    },
    "UsesPolicy": {
      "description": "A singular policy for a `uses:` reference.",
      "oneOf": [
        {
          "description": "No policy; all `uses:` references are allowed, even unpinned ones.",
          "type": "string",
          "enum": [
            "any"
          ]
        },
        {
          "description": "`uses:` references must be pinned to a tag, branch, or hash ref.",
          "type": "string",
          "enum": [
            "ref-pin"
          ]
        },
        {
          "description": "`uses:` references must be pinned to a hash ref.",
          "type": "string",
          "enum": [
            "hash-pin"
          ]
        }
      ]
    },
    "WorkflowRule": {
      "description": "A workflow ignore rule in the format: filename.yml, filename.yml:line, or filename.yml:line:col",
      "type": "string",
      "pattern": "^[^:]+\\.ya?ml(:[1-9][0-9]*)?(:[1-9][0-9]*)?$"
    }
  }
}
